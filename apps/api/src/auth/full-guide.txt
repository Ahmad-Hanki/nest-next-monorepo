Dependencies

Install all required packages:

npm i argon2 @nestjs/jwt @nestjs/passport passport passport-jwt @nestjs/config
npm i -D @types/passport-jwt


ðŸ”¹ Step 1: User Creation (Register)
File: apps/api/src/user/user.service.ts
Hash password using argon2 before saving:
Implement the createUser function to store user with hashed password.


ðŸ”¹ Step 2: AuthService â€“ Login & Token Generation
File: apps/api/src/auth/auth.service.ts
validateLocalUser() â†’ checks email and password.
generateToken() â†’ creates a JWT access token.
login() â†’ returns user data + access token.


ðŸ”¹ Step 3: AuthModule Setup
File: apps/api/src/auth/auth.module.ts
Import JwtModule and configure it with environment variables.
âœ… Donâ€™t forget to export the AuthService

ðŸ”¹ Step 4: Enable ConfigModule
File: apps/api/src/app.module.ts
imports: [ConfigModule.forRoot({ isGlobal: true })]
This allows .env variables to be used globally in your app (like JWT_SECRET).

ðŸ”¹ Step 5: Create JWT Strategy
File: apps/api/src/auth/strategies/jwt.strategy.ts
Defines how JWTs are extracted and validated:
Reads token from header (Bearer TOKEN)
Validates with secret
Attaches the user to the request via: 
return this.authService.validateJwtUser(payload.sub);

ðŸ”¹ Step 6: Auth Guard (Route Protection)
Generate and configure:
- nest g gu auth/guards/jwt-auth
File: apps/api/src/auth/guards/jwt-auth.guard.ts
Then, use in resolvers like this
@UseGuards(JwtAuthGuard)

ðŸ”¹ Step 7: (Optional) CurrentUser Decorator
File: apps/api/src/auth/decorators/current-user.decorator.ts
Simplifies extracting the user from request:
@UseGuards(JwtAuthGuard)
Usage:
updateUser(@CurrentUser() user: User) {
  console.log(user.id);
}

